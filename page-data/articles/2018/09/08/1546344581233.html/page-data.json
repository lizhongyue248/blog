{"componentChunkName":"component---src-templates-post-tsx","path":"/articles/2018/09/08/1546344581233.html","result":{"data":{"asciidoc":{"id":"d3a44e51-fbd6-507c-9272-b68d1c3b534c","fields":{"slug":"/articles/2018/09/08/1546344581233.html","birthTime":"2018-09-07T19:17:00.000Z","modifiedTime":"2019-01-01T13:15:24.978Z"},"html":"<div id=\"toc\" class=\"toc\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div id=\"toctitle\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">Table of Contents</div>\n<ul class=\"sectlevel1\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<li data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\"><a href=\"#_前提\">前提</a></li>\n<li data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\"><a href=\"#_问题\">问题</a></li>\n<li data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\"><a href=\"#_解决\">解决</a></li>\n</ul>\n</div>\n<div id=\"preamble\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"sectionbody\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>最近遇到一个比较棘手的问题，以前给易班开发了两个应用 <strong>网薪商城</strong> 和\n<strong>座位预约</strong> ，都是使用 ssh 开发，是自己学习初期开发出来，将它部署在了\ncentos + tomcat 的环境上，域名对应我的二级域名 yiban.echocow.cn/YBStore\n和 yiban.echocow.cn/YBSeatOrder ，后面的路径对应不同的应用，用 tomcat\n做的多域名配置。而后面，又开发了一个 <strong>易运动</strong>\n应用，但是这个应用完全是前后端分离的，使用 nginx 代理静态页面，vertx\n做后端部署在服务器的 8000 端口，域名同样使用\nyiban.echocow.cn，引用对应的路径为 /YBSport</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<h2 id=\"_前提\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">前提</h2>\n<div class=\"sectionbody\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>目前已有的应用，部署在 tomcat 之上</p>\n</div>\n<div class=\"ulist\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<ul data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<li data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>tomcat admin —— admin.echocow.cn</p>\n</li>\n<li data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>网薪商城 ———— yiban.echocow.cn/YBStore</p>\n</li>\n<li data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>座位预约 ———— yiban.echoocw.cn/YBSeatOrder</p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>配置文件 server.xml 中 Service 如下</p>\n</div>\n<div class=\"listingblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"content\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<pre class=\"highlight\"><code class=\"language-xml\" data-lang=\"xml\">&lt;Service name=\"Catalina\"&gt;\n  &lt;Connector port=\"80\" protocol=\"HTTP/1.1\" connectionTimeout=\"20000\" redirectPort=\"8443\"\n         URIEncoding='GBK' acceptCount=\"500\" maxThreads=\"400\"  maxHttpHeaderSize=\"8192\" /&gt;\n  &lt;Connector port=\"8009\" protocol=\"AJP/1.3\" redirectPort=\"8443\" /&gt;\n  &lt;Engine name=\"Catalina\" defaultHost=\"localhost\"&gt;\n    &lt;Realm className=\"org.apache.catalina.realm.LockOutRealm\"&gt;\n      &lt;Realm className=\"org.apache.catalina.realm.UserDatabaseRealm\"\n           resourceName=\"UserDatabase\"/&gt;\n      &lt;/Realm&gt;\n    &lt;!-- 管理员 --&gt;\n    &lt;Host name=\"admin.echocow.cn\" appBase=\"webapps\" unpackWARs=\"true\" autoDeploy=\"true\"&gt;\n      &lt;Valve className=\"org.apache.catalina.valves.AccessLogValve\" directory=\"logs\"\n           prefix=\"localhost_access_log\" suffix=\".txt\"\n           pattern=\"%h %l %u %t &amp;quot;%r&amp;quot; %s %b\" /&gt;\n    &lt;/Host&gt;\n    &lt;!-- 易班 --&gt;\n    &lt;Host name=\"yiban.echocow.cn\" appBase=\"webapps/yiban\" port=\"80\" protocol=\"HTTP/1.1\"\n        connectionTimeout=\"20000\" redirectPort=\"8443\" unpackWARs=\"true\" autoDeploy=\"true\"&gt;\n        &lt;Context path=\"/YBSeatOrder\" docBase=\"YBSeatOrder\" debug=\"0\" reloadable=\"true\" /&gt;\n        &lt;Context path=\"/YBStore\" docBase=\"YBStore\" debug=\"0\" reloadable=\"true\" /&gt;\n    &lt;/Host&gt;\n  &lt;/Engine&gt;\n&lt;/Service&gt;</code></pre>\n</div>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>有一个新应用 <strong>易运动</strong> ，部署在 nginx 上，配置如下：</p>\n</div>\n<div class=\"listingblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"content\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<pre class=\"highlight\"><code class=\"language-conf\" data-lang=\"conf\">server {\n    listen 80;\n    server_name yiban.echocow.cn;\n    access_log  logs/yiban.access.log  main;\n    location /YBSport {\n        root    /root/yiban/;\n        index   index.html;\n    }\n}</code></pre>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<h2 id=\"_问题\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">问题</h2>\n<div class=\"sectionbody\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>tomcat 与 nginx 同时占用了 80 端口，只能舍掉一个，但是只能使用 nginx\n，因为 tomcat 对静态页面支持是没有 nginx 好的。</p>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p><strong>所以，我必须在 不改变原来应用 和 路径 的情况下，将 tomcat 部署到 nginx\n之中</strong></p>\n</div>\n</div>\n</div>\n<div class=\"sect1\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<h2 id=\"_解决\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">解决</h2>\n<div class=\"sectionbody\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>一开始不打算修改 tomcat 的配置的，但是后来发现不修改不行。不能使用\ntomcat 的域名配置，只能使用 nginx 的域名配置，<strong>然后将 tomcat\n的应用部署在本地不同端口上，使用 nginx\n对不同路径的应用进行重定向至其本地端口上。</strong></p>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>tomcat server,xml修改配置文件如下：</p>\n</div>\n<div class=\"listingblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"content\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<pre class=\"highlight\"><code class=\"language-xml\" data-lang=\"xml\">&lt;!-- 8080 端口 --- 管理员 --&gt;\n&lt;Service name=\"Catalina\"&gt;\n   &lt;Connector port=\"8080\" protocol=\"HTTP/1.1\" connectionTimeout=\"20000\"\n               redirectPort=\"8443\"  URIEncoding='GBK'\n              acceptCount=\"500\" maxThreads=\"400\"  maxHttpHeaderSize=\"8192\" /&gt;\n   &lt;Connector port=\"8009\" protocol=\"AJP/1.3\" redirectPort=\"8443\" /&gt;\n   &lt;Engine name=\"Catalina\" defaultHost=\"localhost\"&gt;\n     &lt;Realm className=\"org.apache.catalina.realm.LockOutRealm\"&gt;\n     &lt;Realm className=\"org.apache.catalina.realm.UserDatabaseRealm\"\n         resourceName=\"UserDatabase\"/&gt;\n     &lt;/Realm&gt;\n     &lt;!-- 部署到本地 --&gt;\n     &lt;Host name=\"localhost\"  appBase=\"webapps\" unpackWARs=\"true\" autoDeploy=\"true\"&gt;\n        &lt;Valve className=\"org.apache.catalina.valves.AccessLogValve\" directory=\"logs\"\n             prefix=\"localhost_access_log\" suffix=\".txt\"\n             pattern=\"%h %l %u %t &amp;quot;%r&amp;quot; %s %b\" /&gt;\n     &lt;/Host&gt;\n  &lt;/Engine&gt;\n&lt;/Service&gt;\n\n&lt;!-- 8081 端口 --- 易班引用 --&gt;\n&lt;Service name=\"Catalina\"&gt;\n  &lt;Connector port=\"8081\" protocol=\"HTTP/1.1\" connectionTimeout=\"20000\" redirectPort=\"8443\"\n         URIEncoding='GBK' acceptCount=\"500\" maxThreads=\"400\"  maxHttpHeaderSize=\"8192\" /&gt;\n  &lt;Connector port=\"8010\" protocol=\"AJP/1.3\" redirectPort=\"8443\" /&gt;\n  &lt;!-- 部署到本地 --&gt;\n  &lt;Engine name=\"Catalina\" defaultHost=\"localhost\"&gt;\n    &lt;Realm className=\"org.apache.catalina.realm.LockOutRealm\"&gt;\n    &lt;Realm className=\"org.apache.catalina.realm.UserDatabaseRealm\"\n         resourceName=\"UserDatabase\"/&gt;\n    &lt;/Realm&gt;\n    &lt;Host name=\"localhost\"  appBase=\"webapps/yiban\" port=\"80\" protocol=\"HTTP/1.1\"\n        connectionTimeout=\"20000\" redirectPort=\"8443\" unpackWARs=\"true\" autoDeploy=\"true\"&gt;\n        &lt;Context path=\"/YBSeatOrder\" docBase=\"YBSeatOrder\" debug=\"0\" reloadable=\"true\" /&gt;\n        &lt;Context path=\"/YBStore\" docBase=\"YBStore\" debug=\"0\" reloadable=\"true\" /&gt;\n    &lt;/Host&gt;\n  &lt;/Engine&gt;\n&lt;/Service&gt;</code></pre>\n</div>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>这样，对应下来就是</p>\n</div>\n<table class=\"tableblock frame-all grid-all stretch\">\n<colgroup>\n<col style=\"width: 50%;\">\n<col style=\"width: 50%;\">\n</colgroup>\n<thead>\n<tr>\n<th class=\"tableblock halign-left valign-top\">应用</th>\n<th class=\"tableblock halign-left valign-top\">url</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">管理员</p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">localhost:8080</p></td>\n</tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">网薪商城</p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">localhost:8081/YBStore</p></td>\n</tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">座位预约</p></td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">localhost:8081/YBSeatOrder</p></td>\n</tr>\n</tbody>\n</table>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>nginx 就可以对其交给不同的端口的应用来处理了：</p>\n</div>\n<div class=\"listingblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"content\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<pre class=\"highlight\"><code class=\"language-conf\" data-lang=\"conf\">server {\n    listen 80;\n    server_name yiban.echocow.cn;\n    access_log  logs/yiban.access.log  main;\n    # 易运动\n    location /YBSport {\n        root    /root/yiban/;\n        index   index.html;\n    }\n    # 网薪商城\n    location /YBStore {\n        proxy_pass http://127.0.0.1:8081/YBStore;\n        proxy_redirect default;\n    }\n    # 作为预约\n    location /YBSeatOrder/ {\n        proxy_pass http://127.0.0.1:8081/YBStore;\n        proxy_redirect default;\n    }\n}</code></pre>\n</div>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>这样就能实现 nginx 即代理静态页面又代理 tomcat 了。</p>\n</div>\n</div>\n</div>","document":{"title":"CentOS7 tomcat 多域名 多应用 添加到 nginx"},"pageAttributes":{"category":"归档","description":"CentOS7 tomcat 多域名 多应用 添加到 nginx","image":"https://img.hacpai.com/bing/20180815.jpg?imageView2/1/w/1280/h/720/interlace/1/q/100","sort":null}}},"pageContext":{"slug":"/articles/2018/09/08/1546344581233.html","next":{"document":{"title":"idea Error:failed to create a child event loop."},"fields":{"slug":"/articles/2018/09/09/1546344585141.html"}},"previous":{"document":{"title":"为什么 Github 没有记录你的 Contributions"},"fields":{"slug":"/articles/2018/07/18/1546344587551.html"}}}},"staticQueryHashes":["3069561552","3673333084"]}