{"componentChunkName":"component---src-templates-post-tsx","path":"/articles/2018/02/20/1546344584166.html","result":{"data":{"asciidoc":{"id":"d02cd476-cf21-5acb-9971-495f637c80dd","fields":{"slug":"/articles/2018/02/20/1546344584166.html","birthTime":"2018-02-20T00:35:00.000Z","modifiedTime":"2019-01-01T12:42:26.670Z"},"html":"<div id=\"toc\" class=\"toc\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div id=\"toctitle\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">Table of Contents</div>\n<ul class=\"sectlevel1\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<li data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\"><a href=\"#_操作\">操作</a></li>\n</ul>\n</div>\n<div id=\"preamble\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"sectionbody\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"quoteblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<blockquote>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>在 serverX 配置 NFS 服务，要求如下： - 以只读的形式共享目录 /public\n同时只能被 example.com 域中的系统访问。 - 以读写的形式共享目录\n/protected 同时只能被 example.com 域中的系统访问。 - 访问 /protected\n需要通过 Kerberos 安全加密，您可以使用下面提供的密钥：\n<a href=\"http://classroom.example.com/pub/keytabs/serverX.keytab\" class=\"bare\">http://classroom.example.com/pub/keytabs/serverX.keytab</a> - 目录\n/protected 应该包含名为 project 拥有人为 ldapuserX 的子目录 - 用户\nldapuserX 能以读写形式访问/ protected/project</p>\n</div>\n</blockquote>\n</div>\n</div>\n</div>\n<div class=\"sect1\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<h2 id=\"_操作\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">操作</h2>\n<div class=\"sectionbody\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>创建目录</p>\n</div>\n<div class=\"literalblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"content\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<pre>mkdir /publicmkdir -p /protected/project</pre>\n</div>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>修改目录权限，protected 需要有读写权限，project 需要修改拥有人身份</p>\n</div>\n<div class=\"literalblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"content\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<pre>chmod o+w /protected/ -R\nchown ldapuser0 /protected/project/</pre>\n</div>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>打标签</p>\n</div>\n<div class=\"literalblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"content\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<pre>semanage fcontext -a -t public_content_t '/protected(/.*)?'\nrestorecon -RvF /protected/</pre>\n</div>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>下载kerberos证书到 /etc/krb5.keytab</p>\n</div>\n<div class=\"literalblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"content\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<pre>wget -O /etc/krb5.keytab http://classroom.example.com/pub/keytabs/server0.keytab</pre>\n</div>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p><code>vim /etc/exports</code> 修改文件，增加共享信息。</p>\n</div>\n<div class=\"literalblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"content\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<pre>/public 172.25.0.0/24(ro) #要共享的目录 允许访问的ip段 参数\n/protected 172.25.0.0/24(rw,sec=krb5p)</pre>\n</div>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>启动NFS相关服务，并设置开机启动 nfs-server 和 nfs-secure-server</p>\n</div>\n<div class=\"literalblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"content\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<pre>systemctl restart nfs-server nfs-secure-server\nsystemctl enable nfs-server nfs-secure-server</pre>\n</div>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>如果没有下载kerberos证书，或者下载不正确，是不能正常启动nfs-secure-server的</p>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>配置防火墙 允许相关服务 nfs、rpc-bind和mountd</p>\n</div>\n<div class=\"literalblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"content\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<pre>firewall-cmd --permanent --add-service=nfs\nfirewall-cmd --permanent --add-service=rpc-bind\nfirewall-cmd --permanent --add-service=mountd\nfirewall-cmd --reload</pre>\n</div>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>配置到这里就完成了。如果想要查看输出的共享信息，可以使用\n`exportfs -v`查看</p>\n</div>\n<div class=\"literalblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"content\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<pre>[root@server0 ~]# exportfs -v/public         172.25.0.0/24(ro,wdelay,root_squash,no_subtree_check,sec=sys,ro,secure,root_squash,no_all_squash)/protected      172.25.0.0/24(rw,wdelay,root_squash,no_subtree_check,sec=krb5p,rw,secure,root_squash,no_all_squash)</pre>\n</div>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>如果你修改了 /etc/exports 配置，不想重启服务又想立即生效，可以使用\n<code>exportfs -arv</code></p>\n</div>\n</div>\n</div>","document":{"title":"[rhce] 10 配置 NFS 服务"},"pageAttributes":{"category":"rhce","description":"rhce 10 配置 NFS 服务","image":"https://img.hacpai.com/bing/20180304.jpg?imageView2/1/w/1280/h/720/interlace/1/q/100","sort":null}}},"pageContext":{"slug":"/articles/2018/02/20/1546344584166.html","next":{"document":{"title":"[rhce] 11 挂载一个NFS共享"},"fields":{"slug":"/articles/2018/02/20/1546344584550.html"}},"previous":{"document":{"title":"[rhce] 9 配置多用户 SMB 挂载"},"fields":{"slug":"/articles/2018/02/20/1546344586111.html"}}}},"staticQueryHashes":["3069561552","3673333084"]}