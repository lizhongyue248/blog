{"componentChunkName":"component---src-templates-post-tsx","path":"/articles/2018/02/23/1546344587014.html","result":{"data":{"asciidoc":{"id":"041845ab-c48c-5d40-b7cb-a59c0fa305c7","fields":{"slug":"/articles/2018/02/23/1546344587014.html","birthTime":"2018-02-23T02:02:00.000Z","modifiedTime":"2019-01-01T12:38:05.514Z"},"html":"<div id=\"toc\" class=\"toc\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div id=\"toctitle\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">Table of Contents</div>\n<ul class=\"sectlevel1\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<li data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\"><a href=\"#_操作\">操作</a></li>\n</ul>\n</div>\n<div id=\"preamble\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"sectionbody\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"quoteblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<blockquote>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>配置system1提供一个ISCSI 服务磁盘名为 iqn.2014-08.com.example:system1\n并符合下列要求： 1. 服务端口为3260 2.\n使用iscsi_store作其后端卷名称，其大小为3G 3.\n此服务只能被system2.group8.example.com访问</p>\n</div>\n</blockquote>\n</div>\n</div>\n</div>\n<div class=\"sect1\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<h2 id=\"_操作\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">操作</h2>\n<div class=\"sectionbody\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>安装 target 、开启服务并开机启动</p>\n</div>\n<div class=\"literalblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"content\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<pre>yum install targetcli.noarch -y\nsystemctl enable target\nsystemctl start target\nfirewall-cmd --permanent --add-port=3260/tcp    //需要配置访问控制、富规则\nfirewall-cmd --reload</pre>\n</div>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>为其创建后端卷并查看</p>\n</div>\n<div class=\"literalblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"content\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<pre>[root@system1 ~]# fdisk /dev/sda\nWelcome to fdisk (util-linux 2.23.2).\n\nChanges will remain in memory only, until you decide to write them.\nBe careful before using the write command.\n\n\nCommand (m for help): n\nPartition type:\n   p   primary (2 primary, 0 extended, 2 free)\n   e   extended\nSelect (default p): p\nPartition number (3,4, default 3):\nFirst sector (26626048-41943039, default 26626048):\nUsing default value 26626048\nLast sector, +sectors or +size{K,M,G} (26626048-41943039, default 41943039): +3G\nPartition 3 of type Linux and of size 3 GiB is set\n\nCommand (m for help): w\nThe partition table has been altered!\n\nCalling ioctl() to re-read partition table.\n\nWARNING: Re-reading the partition table failed with error 16: Device or resource busy.\nThe kernel still uses the old table. The new table will be used at\nthe next reboot or after you run partprobe(8) or kpartx(8)\nSyncing disks.\n[root@system1 ~]# lsblk\nNAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT\nsda      8:0    0   20G  0 disk\n├─sda1   8:1    0  9.8G  0 part /\n└─sda2   8:2    0    3G  0 part [SWAP]\n[root@system1 ~]# partprobe\n[root@system1 ~]# lsblk\nNAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT\nsda      8:0    0   20G  0 disk\n├─sda1   8:1    0  9.8G  0 part /\n├─sda2   8:2    0    3G  0 part [SWAP]\n└─sda3   8:3    0    3G  0 part\n配置 ISCSI 并重启服务\n[root@system1 ~]# targetcli\nWarning: Could not load preferences file /root/.targetcli/prefs.bin.\ntargetcli shell version 2.1.fb34\nCopyright 2011-2013 by Datera, Inc and others.\nFor help on commands, type 'help'.\n\n/&gt; ls\no- / ......................................................................................................................... [...]\n  o- backstores .............................................................................................................. [...]\n  | o- block .................................................................................................. [Storage Objects: 0]\n  | o- fileio ................................................................................................. [Storage Objects: 0]\n  | o- pscsi .................................................................................................. [Storage Objects: 0]\n  | o- ramdisk ................................................................................................ [Storage Objects: 0]\n  o- iscsi ............................................................................................................ [Targets: 0]\n  o- loopback ......................................................................................................... [Targets: 0]\n/&gt; /backstores/block create name=iscsi_store dev=/dev/sda3\nCreated block storage object iscsi_store using /dev/sda3.\n// 创建后端卷\n\n/&gt; ls\no- / ......................................................................................................................... [...]\n  o- backstores .............................................................................................................. [...]\n  | o- block .................................................................................................. [Storage Objects: 1]\n  | | o- iscsi_store ................................................................... [/dev/sda3 (3.0GiB) write-thru deactivated]\n  | o- fileio ................................................................................................. [Storage Objects: 0]\n  | o- pscsi .................................................................................................. [Storage Objects: 0]\n  | o- ramdisk ................................................................................................ [Storage Objects: 0]\n  o- iscsi ............................................................................................................ [Targets: 0]\n  o- loopback ......................................................................................................... [Targets: 0]\n/&gt; /iscsi create wwn=iqn.2014-08.com.example:system1\nCreated target iqn.2014-08.com.example:system1.\nCreated TPG 1.\n\n/&gt; ls\no- / ......................................................................................................................... [...]\n  o- backstores .............................................................................................................. [...]\n  | o- block .................................................................................................. [Storage Objects: 1]\n  | | o- iscsi_store ................................................................... [/dev/sda3 (3.0GiB) write-thru deactivated]\n  | o- fileio ................................................................................................. [Storage Objects: 0]\n  | o- pscsi .................................................................................................. [Storage Objects: 0]\n  | o- ramdisk ................................................................................................ [Storage Objects: 0]\n  o- iscsi ............................................................................................................ [Targets: 1]\n  | o- iqn.2014-08.com.example:system1 ................................................................................... [TPGs: 1]\n  |   o- tpg1 ............................................................................................... [no-gen-acls, no-auth]\n  |     o- acls .......................................................................................................... [ACLs: 0]\n  |     o- luns .......................................................................................................... [LUNs: 0]\n  |     o- portals .................................................................................................... [Portals: 0]\n  o- loopback ......................................................................................................... [Targets: 0]\n/&gt; /iscsi/iqn.2014-08.com.example:system1/tpg1/acls create\nadd_mapped_luns=  wwn=\n...........................................................wwn|keyword=\n/&gt; /iscsi/iqn.2014-08.com.example:system1/tpg1/acls create iqn.2014-08.com.example:system2\nCreated Node ACL for iqn.2014-08.com.example:system2\n//访问控制\n\n/&gt; ls\no- / ......................................................................................................................... [...]\n  o- backstores .............................................................................................................. [...]\n  | o- block .................................................................................................. [Storage Objects: 1]\n  | | o- iscsi_store ................................................................... [/dev/sda3 (3.0GiB) write-thru deactivated]\n  | o- fileio ................................................................................................. [Storage Objects: 0]\n  | o- pscsi .................................................................................................. [Storage Objects: 0]\n  | o- ramdisk ................................................................................................ [Storage Objects: 0]\n  o- iscsi ............................................................................................................ [Targets: 1]\n  | o- iqn.2014-08.com.example:system1 ................................................................................... [TPGs: 1]\n  |   o- tpg1 ............................................................................................... [no-gen-acls, no-auth]\n  |     o- acls .......................................................................................................... [ACLs: 1]\n  |     | o- iqn.2014-08.com.example:system2 ...................................................................... [Mapped LUNs: 0]\n  |     o- luns .......................................................................................................... [LUNs: 0]\n  |     o- portals .................................................................................................... [Portals: 0]\n  o- loopback ......................................................................................................... [Targets: 0]\n/&gt; /iscsi/iqn.2014-08.com.example:system1/tpg1/luns\n@last      cd         delete     get        ls         refresh    status\nbookmarks  create     exit       help       pwd        set\n....................................................command\n/&gt; /iscsi/iqn.2014-08.com.example:system1/tpg1/luns create /backstores/block/iscsi_store\nCreated LUN 0.\nCreated LUN 0-&gt;0 mapping in node ACL iqn.2014-08.com.example:system2\n/&gt; ls\no- / ......................................................................................................................... [...]\n  o- backstores .............................................................................................................. [...]\n  | o- block .................................................................................................. [Storage Objects: 1]\n  | | o- iscsi_store ..................................................................... [/dev/sda3 (3.0GiB) write-thru activated]\n  | o- fileio ................................................................................................. [Storage Objects: 0]\n  | o- pscsi .................................................................................................. [Storage Objects: 0]\n  | o- ramdisk ................................................................................................ [Storage Objects: 0]\n  o- iscsi ............................................................................................................ [Targets: 1]\n  | o- iqn.2014-08.com.example:system1 ................................................................................... [TPGs: 1]\n  |   o- tpg1 ............................................................................................... [no-gen-acls, no-auth]\n  |     o- acls .......................................................................................................... [ACLs: 1]\n  |     | o- iqn.2014-08.com.example:system2 ...................................................................... [Mapped LUNs: 1]\n  |     |   o- mapped_lun0 ........................................................................... [lun0 block/iscsi_store (rw)]\n  |     o- luns .......................................................................................................... [LUNs: 1]\n  |     | o- lun0 .................................................................................. [block/iscsi_store (/dev/sda3)]\n  |     o- portals .................................................................................................... [Portals: 0]\n  o- loopback ......................................................................................................... [Targets: 0]\n/&gt; /\n/*            /backstores/  /iscsi/       /loopback/\n...path\n/&gt; /iscsi/iqn.2014-08.com.example:system1/tpg1/portals\n@last      cd         delete     get        ls         refresh    status\nbookmarks  create     exit       help       pwd        set\n.......................................................command\n/&gt; /iscsi/iqn.2014-08.com.example:system1/tpg1/portals create 172.24.8.11\nUsing default IP port 3260\nCreated network portal 172.24.8.11:3260.\n/&gt; saveconfig\nLast 10 configs saved in /etc/target/backup.\nConfiguration saved to /etc/target/saveconfig.json\n/&gt; exit\nGlobal pref auto_save_on_exit=true\nLast 10 configs saved in /etc/target/backup.\nConfiguration saved to /etc/target/saveconfig.json\n[root@system1 ~]# systemctl restart target.service\n[root@system1 ~]# systemctl enable target.service</pre>\n</div>\n</div>\n</div>\n</div>","document":{"title":"[rhce] 19 配置ISCSI服务端"},"pageAttributes":{"category":"rhce","description":"rhce 19 配置ISCSI服务端","image":"https://img.hacpai.com/bing/20180510.jpg?imageView2/1/w/1280/h/720/interlace/1/q/100","sort":null}}},"pageContext":{"slug":"/articles/2018/02/23/1546344587014.html","next":{"document":{"title":"[rhce] 20 配置 ISCSI 的客户端"},"fields":{"slug":"/articles/2018/02/24/1546344585841.html"}},"previous":{"document":{"title":"[rhce] 18 创建一个添加用户的脚本"},"fields":{"slug":"/articles/2018/02/23/1546344585394.html"}}}},"staticQueryHashes":["3069561552","3673333084"]}