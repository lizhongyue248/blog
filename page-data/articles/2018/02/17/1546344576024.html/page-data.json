{"componentChunkName":"component---src-templates-post-tsx","path":"/articles/2018/02/17/1546344576024.html","result":{"data":{"asciidoc":{"id":"224b3c08-4155-5da8-a1ca-64aaf61dc8d4","fields":{"slug":"/articles/2018/02/17/1546344576024.html","birthTime":"2018-02-17T10:17:00.000Z","modifiedTime":"2019-01-01T12:43:20.605Z"},"html":"<div id=\"toc\" class=\"toc\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div id=\"toctitle\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">Table of Contents</div>\n<ul class=\"sectlevel1\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<li data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\"><a href=\"#_方法一直接修改配置文件\">方法一：直接修改配置文件</a></li>\n<li data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\"><a href=\"#_方法二使用_postconf_修改\">方法二：使用 postconf 修改</a></li>\n<li data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\"><a href=\"#_练习题\">练习题</a></li>\n</ul>\n</div>\n<div id=\"preamble\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"sectionbody\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"quoteblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<blockquote>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>在系统server0和desktop0上配置邮件服务，满足以下要求： -\n这些系统不接收外部发送来的邮件 -\n这些系统上本地发送的任何邮件都会自动路由到 classroom.example.com -\n从这些系统上发送的邮件都显示来自 example.com -\n你可以通过发送邮件到本地用户student来测试你的配置，</p>\n</div>\n<div class=\"ulist\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<ul data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<li data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>classroom.example.com已经配置好。把此用户的邮件转到下列URL\n<a href=\"http://classroom.example.com/cgi-bin/recevied_mail\" class=\"bare\">http://classroom.example.com/cgi-bin/recevied_mail</a></p>\n</li>\n</ul>\n</div>\n</blockquote>\n</div>\n<div class=\"quoteblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<blockquote>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>*使用 postfix\n服务完成上述题目。一般都默认安装了这个服务，并处于默认开机启动状态。但是建议还是检查一下。\n*</p>\n</div>\n</blockquote>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>server47 和 desktop47 配置一致，仅用 server47 做演示。</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<h2 id=\"_方法一直接修改配置文件\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">方法一：直接修改配置文件</h2>\n<div class=\"sectionbody\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p><strong>/etc/postfix/main.cf</strong> 主要修改下面几处</p>\n</div>\n<div class=\"literalblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"content\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<pre>inet_interfaces = loopback-only #监听本地回环接口\nmyorigin = example.com #设置来源域名\nrelayhost = [classroom.example.com] #中转的服务器，没有MX记录的用中括号包起来\nmydestination =  #不接受任何邮件\nmynetworks = 127.0.0.0/8, [::1]/128 #本地网络\nlocal_transport = error: local delivery disabled #其实是非必须的</pre>\n</div>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>`systemctl restart postfix`重启邮件服务</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<h2 id=\"_方法二使用_postconf_修改\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">方法二：使用 postconf 修改</h2>\n<div class=\"sectionbody\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>这是专门用来查看 postfix 配置和修改 postfix\n配置的工具。个人也是推荐这种做法。</p>\n</div>\n<div class=\"literalblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"content\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<pre>[root@server0 ~]# postconf -e 'inet_interfaces=loopback-only'\n[root@server0 ~]# postconf -e 'myorigin=example.com'\n[root@server0 ~]# postconf -e 'relayhost=[classroom.example.com]'\n[root@server0 ~]# postconf -e 'mydestination='\n[root@server0 ~]# postconf -e 'mynetworks=127.0.0.0/8, [::1]/128'\n[root@server0 ~]# postconf -e 'local_transport=error: local delivery disabled'\n[root@server0 ~]# systemctl restart postfix</pre>\n</div>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>测试</p>\n</div>\n<div class=\"literalblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"content\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<pre>[root@server0 ~]# mail -s 'fuxk' student@classroom.example.com\nerwerwr\n.\nEOT\n[root@server0 ~]# curl http://classroom.example.com/cgi-bin/recevied_mail\n\nFrom root@example.com  Tue Jan  3 14:43:46 2017&lt;br&gt;Return-Path: &lt;root@example.com&gt;&lt;br&gt;X-Original-To: student@classroom.example.com&lt;br&gt;Delivered-To: student@classroom.example.com&lt;br&gt;Received: from server0.example.com (server0.example.com [172.25.0.11])&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbspby classroom.example.com (Postfix) with ESMTP id 1BB802ACC19&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbspfor &lt;student@classroom.example.com&gt;; Tue,  3 Jan 2017 14:43:46 +0800 (CST)&lt;br&gt;Received: by server0.example.com (Postfix, from userid 0)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbspid D05FEEAEEA; Tue,  3 Jan 2017 14:43:44 +0800 (CST)&lt;br&gt;Date: Tue, 03 Jan 2017 14:43:44 +0800&lt;br&gt;To: student@classroom.example.com&lt;br&gt;Subject: fuxk&lt;br&gt;User-Agent: Heirloom mailx 12.5 7/5/10&lt;br&gt;MIME-Version: 1.0&lt;br&gt;Content-Type: text/plain; charset=us-ascii&lt;br&gt;Content-Transfer-Encoding: 7bit&lt;br&gt;Message-Id: &lt;20170103064344.D05FEEAEEA@server0.example.com&gt;&lt;br&gt;From: root@example.com (root)&lt;br&gt;&lt;br&gt;erwerwr&lt;br&gt;&lt;br&gt;</pre>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<h2 id=\"_练习题\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">练习题</h2>\n<div class=\"sectionbody\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"quoteblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<blockquote>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>在系统 serverX 和 desktopX 上配置邮件服务，满足以下要求：</p>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>这些系统不接收外部发送来的邮件</p>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>这些系统上本地发送的任何邮件都会自动路由到 smtpX.example.com</p>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>从这些系统上发送的邮件都显示来自 desktopX.example.com</p>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>你可以通过发送邮件到本地用户 student 来测试你配置，desktop47.example.com\n已配置好</p>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>注意：模拟环境只需配置 serverX 即可，但考试时需要同配置 serverX 和\ndesktopX</p>\n</div>\n</blockquote>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p><strong>练习时务必在 serverX 和 desktopX 上先启动练习环境</strong></p>\n</div>\n<div class=\"literalblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"content\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<pre>lab smtp-nullclient setup</pre>\n</div>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>使用 postconf 修改</p>\n</div>\n<div class=\"literalblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"content\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<pre>postconf -e \"inet_interfaces=loopback-only\" 监听本地回环接口\npostconf -e \"relayhost=[smtp47.example.com]\" 因为需要自动路由到 smtpX.example.com\npostconf -e \"myorigin=desktop47.example.com\" 需要系统上发送的邮件都显示来自 desktopX.example.com\npostconf -e \"mydestination=\" 不接受任何邮件\npostconf -e \"mynetworks=127.0.0.0/8 [::1]/128\" 设置本地网络\npostconf -e \"local_transport=error:local delivery disable\" 阻止本地空客户端所有邮件在本地转发到/var/spool邮箱中</pre>\n</div>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>systemctl restart postfix 重启服务</p>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>测试</p>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>发送一封主题为 server47 null client 的邮件，内容为 null client test</p>\n</div>\n<div class=\"literalblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"content\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<pre>mail -s \"server47 null client\" student@desktop47.example.com\nnull client test.\n\nEOT</pre>\n</div>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>使用用户名 student 和密码 student 登录</p>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p><span class=\"image\"><img src=\"https://resources.echocow.cn/image/rhce/6.1.png\" alt=\"image\"></span></p>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p><span class=\"image\"><img src=\"https://resources.echocow.cn/image/rhce/6.2.png\" alt=\"image\"></span></p>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p><span class=\"image\"><img src=\"https://resources.echocow.cn/image/rhce/6.3.png\" alt=\"image\"></span></p>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p><span class=\"image\"><img src=\"https://resources.echocow.cn/image/rhce/6.4.png\" alt=\"image\"></span></p>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p><code>lab smtp-nullclient grade</code> 测试</p>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p><span class=\"image\"><img src=\"https://resources.echocow.cn/image/rhce/6.5.png\" alt=\"image\"></span></p>\n</div>\n</div>\n</div>","document":{"title":"[rhce] 6 配置本地邮件服务"},"pageAttributes":{"category":"rhce","description":"配置本地邮件服务","image":"https://img.hacpai.com/bing/20181025.jpg?imageView2/1/w/1280/h/720/interlace/1/q/100","sort":null}}},"pageContext":{"slug":"/articles/2018/02/17/1546344576024.html","next":{"document":{"title":"[rhce] 7 配置端口转发"},"fields":{"slug":"/articles/2018/02/19/1546344575180.html"}},"previous":{"document":{"title":"[rhce] 5 自定义用户环境"},"fields":{"slug":"/articles/2018/02/17/1546344577581.html"}}}},"staticQueryHashes":["3069561552","3673333084"]}