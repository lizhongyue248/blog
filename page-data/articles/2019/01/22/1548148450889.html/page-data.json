{"componentChunkName":"component---src-templates-post-tsx","path":"/articles/2019/01/22/1548148450889.html","result":{"data":{"asciidoc":{"id":"389f86d3-d38f-50b0-baeb-d2ac54f69319","fields":{"slug":"/articles/2019/01/22/1548148450889.html","birthTime":"2019-01-22T09:15:15.069Z","modifiedTime":"2019-01-22T10:38:15.225Z"},"html":"<div id=\"toc\" class=\"toc\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div id=\"toctitle\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">Table of Contents</div>\n<ul class=\"sectlevel1\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<li data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\"><a href=\"#_oauth2\">Oauth2</a></li>\n<li data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\"><a href=\"#_这篇文章能够带给你什么\">这篇文章能够带给你什么</a></li>\n<li data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\"><a href=\"#_在这之前\">在这之前</a>\n<ul class=\"sectlevel2\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<li data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\"><a href=\"#_请求_url\">请求 url</a></li>\n</ul>\n</li>\n<li data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\"><a href=\"#_自动配置\">自动配置</a>\n<ul class=\"sectlevel2\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<li data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\"><a href=\"#_使用默认配置\">使用默认配置</a></li>\n<li data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\"><a href=\"#_自定义配置\">自定义配置</a></li>\n<li data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\"><a href=\"#_测试访问\">测试访问</a></li>\n<li data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\"><a href=\"#_开启_资源服务器\">开启 资源服务器</a></li>\n<li data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\"><a href=\"#_解析_token\">解析 token</a></li>\n<li data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\"><a href=\"#_刷新_token\">刷新 token</a></li>\n</ul>\n</li>\n<li data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\"><a href=\"#_参考链接\">参考链接</a></li>\n</ul>\n</div>\n<div id=\"preamble\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"sectionbody\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>前段时间写了一篇博客，https://echocow.cn/articles/2019/01/05/1546684795983.html[spring\nboot restful API 从零到一完整实践] ，通过上篇文章构建了两个版本的\nrestful api，这篇博客，则是要在这基础上面，添加一个安全措施，我选择的是\noauth2 和 jwt 进行保护我们的 API，通过 spring security oauth2\n进行一步一步的配置我们的安全 API 接口服务。</p>\n</div>\n<div class=\"quoteblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<blockquote>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>博客地址：https://echocow.cn</p>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>项目地址：https://github.com/lizhongyue248/spring-boot-restful-api/tree/security-one[github-security-one\n分支]</p>\n</div>\n</blockquote>\n</div>\n</div>\n</div>\n<div class=\"sect1\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<h2 id=\"_oauth2\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">Oauth2</h2>\n<div class=\"sectionbody\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>OAuth\n2.0关注客户端开发者的简易性。要么通过组织在资源拥有者和HTTP服务商之间的被批准的交互动作代表用户，要么允许第三方应用代表用户获得访问的权限。同时为Web应用，桌面应用和手机，和起居室设备提供专门的认证流程。https://baike.baidu.com/item/OAuth2.0/6788617?fr=aladdin[百度百科]。这篇文章同上一篇一样，将会详细记录如何使用\nspring security oauth2 进行构建一个安全 restful api ，当然，oauth2\n的概念和核心我不再赘述，具体可查看文末的参考链接。在这之前，我们需要先做一番准备。</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<h2 id=\"_这篇文章能够带给你什么\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">这篇文章能够带给你什么</h2>\n<div class=\"sectionbody\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>使用 spring security oauth2 autoconfigure 自动配置一个简单的 oauth2 认证</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<h2 id=\"_在这之前\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">在这之前</h2>\n<div class=\"sectionbody\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>你需要拥有一个已经能够成功构建起来的 spring boot\n的项目，它能够正常启动与访问访问，在这里我们使用上一篇\n<a href=\"https://echocow.cn/articles/2019/01/05/1546684795983.html\">spring boot\nrestful API 从零到一完整实践</a> 构建的 restful API\n作为基础。如果你需要快速体验，你只需要建立一个拥有 Helloworld api\n接口的新项目即可。然后你需要加入以下依赖（gradle）</p>\n</div>\n<div class=\"literalblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"content\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<pre>// 提供 spring security 支持\nimplementation('org.springframework.boot:spring-boot-starter-security')\n// 提供 oauth2 自动化配置\nimplementation(\"org.springframework.security.oauth.boot:spring-security-oauth2-autoconfigure:${springBootVersion}\")</pre>\n</div>\n</div>\n<div class=\"imageblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"content\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<img src=\"https://resources.echocow.cn//file/2019/01/49c932992ee34adebd7b3c3e624d92a2_image.png\" alt=\"在这之前\">\n</div>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p><strong>同时你必须具备如下知识：</strong></p>\n</div>\n<div class=\"olist arabic\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<ol class=\"arabic\">\n<li data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>oauth2 中什么是 授权服务器</p>\n</li>\n<li data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>oauth2 中什么是 资源服务器</p>\n</li>\n<li data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>oauth2 中的四种授权模式（我们会使用到 授权码 模式和 密码 模式）</p>\n</li>\n<li data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>spring security 的部分知识</p>\n</li>\n<li data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>jpa 的使用</p>\n</li>\n</ol>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>以上概念本文不再提起，如有疑惑可选择去文末的参考链接自行选择性学习。</p>\n</div>\n<div class=\"sect2\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<h3 id=\"_请求_url\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">请求 url</h3>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>虽然上面说明了需要知道的东西，但是我在这里还是需要对我们需要使用到的 url\n进行一个简单说明，但是参数我不再详说。</p>\n</div>\n<div class=\"ulist\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<ul data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<li data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>/oauth/authorize GET 授权码模式获取授权码</p>\n</li>\n<li data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>/oauth/token POST 获取token、刷新token</p>\n</li>\n<li data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>/oauth/check_token POST 检测 token</p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<h2 id=\"_自动配置\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">自动配置</h2>\n<div class=\"sectionbody\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>spring boot\n之所以能够如此受欢迎，最大的原因莫过于他提供的模板配置以及自动配置，我们甚至不需要写什么代码，只需要见得修改一下配置文件即可构建一个基于内存的简单的安全服务，所以最重要的，需要先配置一个\n<strong>授权服务器</strong>，通过它下发令牌</p>\n</div>\n<div class=\"sect2\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<h3 id=\"_使用默认配置\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">使用默认配置</h3>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>1、 添加注解：你需要为我们启动类添加一个启动的注解</p>\n</div>\n<div class=\"imageblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"content\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<img src=\"https://resources.echocow.cn//file/2019/01/eec9a5a1d76b4645b6d4517d61a0233f_image.png\" alt=\"授权服务器\">\n</div>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>2、 我们通过一个注解就已经完成一个安全的授权的创建，运行查看输出日志。</p>\n</div>\n<div class=\"imageblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"content\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<img src=\"https://resources.echocow.cn//file/2019/01/ef02659d7bc74ce48528c9a6484195d2_image.png\" alt=\"使用默认配置\">\n</div>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>3、 携带生成的 client id 进行访问，这里 /api\n是我自己添加项目路径，如果没有添加亲直接访问 /oauth/authorize</p>\n</div>\n<div class=\"literalblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"content\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<pre>http://localhost:8080/api/oauth/authorize?response_type=code&amp;client_id=d7003bdc-981c-4745-9eb4-673028b4c4e0&amp;redirect_uri=http://example.com&amp;scope=all</pre>\n</div>\n</div>\n<div class=\"imageblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"content\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<img src=\"https://resources.echocow.cn//file/2019/01/5821ad7971024e67a7aa0c478f9d6980_image.png\" alt=\"imagepng\">\n</div>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>4、 访问报错，这是因为我们没有配置 spring security\n造成的，所以需要回去配置一下，使用默认配置即可</p>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>image::https://resources.echocow.cn//file/2019/01/46bac0e60a024af89ec55896509e6743_image.png[spring\nsecurity]</p>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>5、 再次运行，跳转登录界面</p>\n</div>\n<div class=\"imageblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"content\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<img src=\"https://resources.echocow.cn//file/2019/01/1d480c70ade941749ad2df5ee2e15358_image.png\" alt=\"访问\">\n</div>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>6、 用户名 <code>user</code>，密码为刚才生成的 随机密码,登录</p>\n</div>\n<div class=\"imageblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"content\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<img src=\"https://resources.echocow.cn//file/2019/01/9d9aede6f73b4521995753bc74583dbe_image.png\" alt=\"登录\">\n</div>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>7、 修改配置文件。注册一下回调地址</p>\n</div>\n<div class=\"imageblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"content\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<img src=\"https://resources.echocow.cn//file/2019/01/6a206b4ad888453cb3d53d0cf5d33495_image.png\" alt=\"修改配置文件\">\n</div>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>8、 重启，使用新生成的 client id ，重新访问以及登录</p>\n</div>\n<div class=\"imageblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"content\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<img src=\"https://resources.echocow.cn//file/2019/01/15d8ea79040349fc8b69ee18d5aa91d8_image.png\" alt=\"登录成功\">\n</div>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>9、 选择 Approve 同意授权，获取到授权码</p>\n</div>\n<div class=\"imageblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"content\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<img src=\"https://resources.echocow.cn//file/2019/01/7e68ec23752b47c18e4b20468be9bffe_image.png\" alt=\"Approve\">\n</div>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>10、 使用授权码请求token</p>\n</div>\n<div class=\"imageblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"content\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<img src=\"https://resources.echocow.cn//file/2019/01/9b9bbf0762e042a0aec1ac1c3f9d18ec_image.png\" alt=\"使用授权码请求token\">\n</div>\n</div>\n<div class=\"imageblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"content\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<img src=\"https://resources.echocow.cn//file/2019/01/45f06da95b294d75a4a1105bb783c3ac_image.png\" alt=\"使用授权码请求token\">\n</div>\n</div>\n<div class=\"imageblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"content\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<img src=\"https://resources.echocow.cn//file/2019/01/eaa2b00de92643f289e61d850c341312_image.png\" alt=\"获取成功\">\n</div>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>这就是使用他的自动配置的认证过程，接下来我们通过配置文件进行控制他的自动配置</p>\n</div>\n</div>\n<div class=\"sect2\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<h3 id=\"_自定义配置\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">自定义配置</h3>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>1、 修改 spring boot 的一些默认配置</p>\n</div>\n<div class=\"imageblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"content\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<img src=\"https://resources.echocow.cn//file/2019/01/b4e0be84b5864f5a8837535f35365d13_image.png\" alt=\"imagepng\">\n</div>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>2、 配置两个用户</p>\n</div>\n<div class=\"imageblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"content\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<img src=\"https://resources.echocow.cn//file/2019/01/32d02da8d3124b43be9a308a2b1e539e_image.png\" alt=\"imagepng\">\n</div>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>3、 现在我们拥有两个用户了，就可以去使用密码模式获取 token 了。</p>\n</div>\n<div class=\"imageblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"content\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<img src=\"https://resources.echocow.cn//file/2019/01/ca3031eec3484516be64a136d7e853b2_image.png\" alt=\"imagepng\">\n</div>\n</div>\n<div class=\"imageblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"content\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<img src=\"https://resources.echocow.cn//file/2019/01/07cfd4841e884e0fa62c8a4b98be990e_image.png\" alt=\"imagepng\">\n</div>\n</div>\n<div class=\"imageblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"content\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<img src=\"https://resources.echocow.cn//file/2019/01/356671ef064c41249b3bdc36b9c58780_image.png\" alt=\"imagepng\">\n</div>\n</div>\n</div>\n<div class=\"sect2\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<h3 id=\"_测试访问\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">测试访问</h3>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>1、 直接访问我们已有的资源</p>\n</div>\n<div class=\"imageblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"content\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<img src=\"https://resources.echocow.cn//file/2019/01/ce2affc8848b4ad0ba4944f77b501970_image.png\" alt=\"直接访问我们已有的资源\">\n</div>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>2、 携带上一步获取的 token 访问</p>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>image::https://resources.echocow.cn//file/2019/01/32fae0a7f55044618a338d33b40a56ac_image.png[携带上一步获取的\ntoken 访问]</p>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>发现还是失败，为什么呢？因为我么并没有开启 资源服务器\n他没办法进行验证，所以我们接下来就是开启一个资源服务器</p>\n</div>\n</div>\n<div class=\"sect2\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<h3 id=\"_开启_资源服务器\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">开启 资源服务器</h3>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>同样，一个注解即可</p>\n</div>\n<div class=\"imageblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"content\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<img src=\"https://resources.echocow.cn//file/2019/01/ed740b7613af4bf5bfe73bd4c8ec5e24_image.png\" alt=\"资源服务器\">\n</div>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>重新获取token后，携带 token 访问</p>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>image::https://resources.echocow.cn//file/2019/01/73f58d0b76564206bf42712234f606ef_image.png[携带\ntoken 访问]</p>\n</div>\n</div>\n<div class=\"sect2\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<h3 id=\"_解析_token\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">解析 token</h3>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>1、 尝试解析 token</p>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>image::https://resources.echocow.cn//file/2019/01/05163891823d4a768e0ba1c3e6a942e4_image.png[尝试解析\ntoken]</p>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>2、 403，我们需要配置以支持 token 解析。</p>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>image::https://resources.echocow.cn//file/2019/01/96a634bddeea42f495fbf13120c3f4a1_image.png[支持\ntoken 解析]</p>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>3、 重启后获取token再次解析</p>\n</div>\n<div class=\"imageblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"content\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<img src=\"https://resources.echocow.cn//file/2019/01/9dc42141faa1418a87f902c141b16398_image.png\" alt=\"重启后获取token再次解析\">\n</div>\n</div>\n</div>\n<div class=\"sect2\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<h3 id=\"_刷新_token\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">刷新 token</h3>\n<div class=\"quoteblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<blockquote>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>遗憾的是，如果只是用配置文件，是不能够 刷新 token 的，至少我没有成功。</p>\n</div>\n</blockquote>\n</div>\n<div class=\"imageblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"content\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<img src=\"https://resources.echocow.cn//file/2019/01/79d18b46df3c41c2b65d31e2fad9d97f_image.png\" alt=\"imagepng\">\n</div>\n</div>\n<div class=\"imageblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"content\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<img src=\"https://resources.echocow.cn//file/2019/01/b8eff0fb4910412fa1f0618f6c4883cb_image.png\" alt=\"imagepng\">\n</div>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>发现不行，查看原因</p>\n</div>\n<div class=\"imageblock\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"content\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<img src=\"https://resources.echocow.cn//file/2019/01/44b4875d231e44a4b4466bced77d801c_image.png\" alt=\"imagepng\">\n</div>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>可惜通过尝试各种办法都不行（在不增加类的情况下）解决办法参见</p>\n</div>\n<div class=\"ulist\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<ul data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<li data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p><a href=\"https://stackoverflow.com/questions/30454480/spring-security-oauth2-2-0-7-refresh-token-userdetailsservice-configuration-us\">stackoverflow：spring-security-oauth2\n2.0.7 refresh token UserDetailsService Configuration -\nUserDetailsService is required</a></p>\n</li>\n<li data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p><a href=\"https://segmentfault.com/a/1190000012338044\">segmentfault: spring\nsecurity oauth2之refresh token</a></p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p>使用他的配置文件，我们不需要写任何代码，就完成了一个简单的内存认证，甚至我们可以直接通过修改\nuserDetailsService\n完成用户的认证，不过也发现了，他使用配置文件的方式功能很有限，局限性很强，不能够刷新\ntoken 是一个痛点啊，所以我们更期望于手动配置。</p>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<h2 id=\"_参考链接\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">参考链接</h2>\n<div class=\"sectionbody\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<div class=\"olist arabic\" data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<ol class=\"arabic\">\n<li data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p><a href=\"http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html\">理解OAuth 2.0\n阮一峰</a></p>\n</li>\n<li data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p><a href=\"https://www.jianshu.com/p/9d0264d27c3b\">Oauth2 授权</a></p>\n</li>\n<li data-sal=\"fade\" data-sal-duration=\"500\" data-sal-repeat=\"true\">\n<p><a href=\"https://docs.spring.io/spring-security-oauth2-boot/docs/current/reference/htmlsingle/\">spring\noauth2 auto config</a></p>\n</li>\n</ol>\n</div>\n</div>\n</div>","document":{"title":"spring boot security oauth2  构建简单安全的 restful api"},"pageAttributes":{"category":"spring","description":"spring boot security oauth2  构建简单安全的 restful api","image":"https://img.hacpai.com/bing/20181202.jpg?imageView2/1/w/1280/h/720/interlace/1/q/100","sort":null}}},"pageContext":{"slug":"/articles/2019/01/22/1548148450889.html","next":{"document":{"title":"vue 加 Material Design 等于 vuetify"},"fields":{"slug":"/articles/2019/01/27/1548583400911.html"}},"previous":{"document":{"title":"vue cli 3 项目与 electron 记录"},"fields":{"slug":"/articles/2019/01/15/1547551133170.html"}}}},"staticQueryHashes":["3069561552","3673333084"]}